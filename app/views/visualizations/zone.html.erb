<!DOCTYPE html>
<html>
<head>
	<style>
		a#target {
		    width: 30px;
		    height: 30px;
		    display: block;
		    margin: 0 auto;
		    margin-left: 300px;
			margin-top: 300px;
		    position: relative;
		}
		a#target #pulse {
		    width: 40px;
		    height: 40px;
		    display: block;
		    position: absolute;
		    top: -2px;
		    left: -2px;
		    border: 2px solid #30a3ec;
		    border-radius: 50px;
		    box-shadow: 0 0 5px #a0eaff;
		    /* Animate */
		    -webkit-animation-name: pulse;
		    -webkit-animation-duration: 1s;
		    -webkit-animation-iteration-count: infinite;
		    -webkit-animation-timing-function: ease-out;
		    -moz-animation-name: pulse;
		    -moz-animation-duration: 1s;
		    -moz-animation-iteration-count: infinite;
		    -moz-animation-timing-function: ease-out;
		    -o-animation-name: pulse;
		    -o-animation-duration: 1s;
		    -o-animation-iteration-count: infinite;
		    -o-animation-timing-function: ease-out;
		    animation-name: pulse;
		    animation-duration: 1s;
		    animation-iteration-count: infinite;
		    animation-timing-function: ease-out;
		}
		
		.pulsing {
/*		    width: 30px;
		    height: 30px;
		    display: block;
		    position: absolute;
		    top: -2px;
		    left: -2px;
		    border: 2px solid #30a3ec;
		    border-radius: 50px;
		    box-shadow: 0 0 5px #a0eaff;*/
		    /* Animate */
		    -webkit-animation-name: pulse;
		    -webkit-animation-duration: 1s;
		    -webkit-animation-iteration-count: infinite;
		    -webkit-animation-timing-function: ease-out;
		    -moz-animation-name: pulse;
		    -moz-animation-duration: 1s;
		    -moz-animation-iteration-count: infinite;
		    -moz-animation-timing-function: ease-out;
		    -o-animation-name: pulse;
		    -o-animation-duration: 1s;
		    -o-animation-iteration-count: infinite;
		    -o-animation-timing-function: ease-out;
		    animation-name: pulse;
		    animation-duration: 1s;
		    animation-iteration-count: infinite;
		    animation-timing-function: ease-out;
		}
		/* The animation */
		/* WebKit/Safari and Chrome */
		@-webkit-keyframes pulse {
		    0% {
		        -webkit-transform: scale(3);
		        transform: scale(0.3);
		        opacity: 0.5;
		    }

		    80% {
		        -webkit-transform: scale(15);
		        transform: scale(1.5);
		        opacity: 0;
		    }

		    100% {
		        -webkit-transform: scale(25);
		        transform: scale(2.5);
		        opacity: 0;
		    }    
		}
		/* Gecko/Firefox */
		@-moz-keyframes pulse {
		    0% {
		        -moz-transform: scale(0.3);
		        transform: scale(0.3);
		        opacity: 0.5;
		    }

		    80% {
		        -moz-transform: scale(1.5);
		        transform: scale(1.5);
		        opacity: 0;
		    }

		    100% {
		        -moz-transform: scale(2.5);
		        transform: scale(2.5);
		        opacity: 0;
		    }    
		}
		/* Presto/Opera */
		@-o-keyframes pulse {
		    0% {
		        -o-transform: scale(0.3);
		        transform: scale(0.3);
		        opacity: 0.5;
		    }

		    80% {
		        -o-transform: scale(1.5);
		        transform: scale(1.5);
		        opacity: 0;
		    }

		    100% {
		        -o-transform: scale(2.5);
		        transform: scale(2.5);
		        opacity: 0;
		    }    
		}
		/* Standard */
		@keyframes pulse {
		    0% {
		        transform: scale(0.3);
		        opacity: 0.5;
		    }

		    80% {
		        transform: scale(1.5);
		        opacity: 0;
		    }

		    100% {
		        transform: scale(2.5);
		        opacity: 0;
		    }    
		}
		
		/* d3.js */
		.chart {
		  background: #fff;
		  border: solid 1px #ddd;
		  box-shadow: 0 0 4px rgba(0,0,0,.2);
		  font: 10px sans-serif;
		  height: 500px;
		  position: relative;
		  width: 720px;
		}

		.chart svg {
/*		  border-left: solid 2px #ddd;*/
		  left: 360px;
		  position: absolute;
		  top: 0;
		}

		.chart pre {
		  font: 12px monospace;
		  height: 60px;
		  left: 10px;
		  position: absolute;
		  top: 0;
		  width: 340px;
		}

		.chart circle.little {
		  fill: #aaa;
		  stroke: #666;
		  stroke-width: 1.5px;
		}
		
		circle.little {
		  fill: #aaa;
		  stroke: #666;
		  stroke-width: 1.5px;
		}

		.chart button {
		  left: 275px;
		  position: absolute;
		  top: 145px;
		  width: 80px;
		}

		.chart .data rect {
		  fill: #eee;
		  stroke: #ccc;
		}
		

	</style>
	
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="user-scalable=yes, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

	<title>Pulsar</title>
	<%= stylesheet_link_tag    "application" %>
	<%= javascript_include_tag "application" %>
	<%= csrf_meta_tags %>
</head>
	<body>
		<div id='content'>
		</div>
		<!-- <div class="chart" id="chart-2">
			<pre class="code">var circle = svg.selectAll("circle");
			</pre>
			<button>Run</button>
			<a href="#" id="target" title="Target">
			    <img src="spot.png" alt="" class="indicator" />
			    <span id="pulse"></span>
			</a>
		</div>	
		<div class="chart" id="chart-3">
			<pre class="code">var circle = svg.selectAll("circle");
			</pre>
			<button>Run</button>
			<a href="#" id="target" title="Target">
			    <img src="spot.png" alt="" class="indicator" />
			    <span id="pulse"></span>
			</a>
		</div> -->
		<a href="#" id="target" title="Target" style='z-index: 2;'>
		<span id="pulse">
			
		</span>
		</a>
		<div id="vis" style='z-index: 4; float:left; position:absolute; margin-left: 25px; margin-top: -300px;'>
		</div>
		
		
		<!-- <div style='z-index: -1;'>
			<a href="#" id="target" title="Target">
			    <img src="spot.png" alt="" class="indicator" />
			    
				<svg width="360" height="180"><span id="pulse"><circle class="little" cx="180" cy="45" r="12"></circle></span></svg>
			</a>
	
		</div> -->
	</body>
	<script>
		(function() {
			var w = 700,
				h = 700;
				
			var svg = d3.select("#vis").append("svg:svg")
				.attr("width", w)
				.attr("height", h);
				
			 
			// var x = d3.scale.linear()
			// 			    .domain([0, 1])
			// 			    .range([0, w]);
			
			// rssi
			var y1 = d3.scale.linear()
			    .domain([10, 35])
			    .range([600, 300]);
			
			var y2 = d3.scale.linear()
			    .domain([10, 35])
			    .range([600, 300]);
			
			var y3 = d3.scale.linear()
			    .domain([10, 35])
			    .range([600, 300]);
			
			var x1 = d3.scale.linear()
			    .domain([10, 35])
			    .range([200, 300]);

			var x2 = d3.scale.linear()
			    .domain([10, 35])
			    .range([600, 300]);

			var x3 = d3.scale.linear()
			    .domain([10, 35])
			    .range([400, 300]);
			
			svg.append("svg:circle")
				.attr("cx", 300)
				.attr("cy", 300)
				.attr("r", 12)
				.style("fill", "steelblue");
			
			var node1 = svg.append("svg:circle")
				.attr("cx", 200)
				.attr("cy", 600)
				.attr("r", 12)
				.style("fill", "black");
				
			var node2 = svg.append("svg:circle")
				.attr("cx", 300)
				.attr("cy", 600)
				.attr("r", 12)
				.style("fill", "black");
			
			var node3 = svg.append("svg:circle")
				.attr("cx", 400)
				.attr("cy", 600)
				.attr("r", 12)
				.style("fill", "black");
			
				
			function redraw(){
				d3.json("/pulse/data", function(json) {
					json.data.forEach(function(item) { 
						alert(item); 
						
						// for link id 1
						if (item.rssi < 10) {
							node1.transition().duration(500).delay(0).style("fill", "black");
							node3.transition().duration(500).delay(500).attr("cx", 200);
							node1.transition().duration(500).delay(500).attr("cy", 600);
							node1.transition().duration(500).delay(1000).attr("r", 30);
						} else {
							node1.transition().duration(500).delay(0).style("fill", "steelblue");
							node1.transition().duration(500).delay(500).attr("cx", x1(rssi));
							node1.transition().duration(500).delay(500).attr("cy", y1(rssi));
							node1.transition().duration(500).delay(1000).attr("r", 20);	
						}
						
						// for link id 2
						if (item.rssi < 10) {
							node2.transition().duration(500).delay(0).style("fill", "black");
							node2.transition().duration(500).delay(500).attr("cy", 600);
							node2.transition().duration(500).delay(1000).attr("r", 30);
						} else {
							node2.transition().duration(500).delay(0).style("fill", "steelblue");
							// node2.transition().duration(500).delay(500).attr("cx", x2(rssi));
							node2.transition().duration(500).delay(500).attr("cy", y2(rssi));
							node2.transition().duration(500).delay(1000).attr("r", 20);	
						}
						
						// for link id 3
						if (item.rssi < 10) {
							node3.transition().duration(500).delay(0).style("fill", "black");
							node3.transition().duration(500).delay(500).attr("cx", 400);
							node3.transition().duration(500).delay(500).attr("cy", 600);
							node3.transition().duration(500).delay(1000).attr("r", 30);
						} else {
							node3.transition().duration(500).delay(0).style("fill", "steelblue");
							node3.transition().duration(500).delay(500).attr("cx", x2(rssi));
							node3.transition().duration(500).delay(500).attr("cy", y3(rssi));
							node3.transition().duration(500).delay(1000).attr("r", 20);	
						}
					});
				});	
			}
			
			setInterval(function() {
			  // data.shift();
			  // data.push(next());
			  redraw();
			}, 1000);
		})();
	</script>
</html>




